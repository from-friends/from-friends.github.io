<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TezTicker Live</title>
    <script src="tezticker/qrcode.min.js"></script>
    <style>*{margin:0;padding:0;box-sizing:border-box}:root{--primary-color:#FF5722;--bg-dark:#000;--bg-medium:#000;--bg-light:#000;--text-primary:#fff;--text-secondary:#b0b0b0;--text-muted:#707070;--border-color:#333;--success-color:#4caf50;--info-color:#2196f3;--warning-color:#ff9800}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell',sans-serif;background-color:var(--bg-dark);color:var(--text-primary);font-size:28px;line-height:1.6;overflow:hidden}.feed-container{padding:60px;display:flex;flex-direction:column;gap:40px;min-height:100vh}.feed-item{display:flex;align-items:stretch;background-color:var(--bg-medium);border-radius:20px;overflow:hidden;position:relative;min-height:350px;cursor:pointer;transition:opacity .5s ease-in-out}.feed-item:hover{transform:scale(1.01);box-shadow:0 8px 40px rgba(255,87,34,.3)}.qr-code-container{position:absolute;bottom:20px;right:20px;width:100px;height:100px;background:#fff;padding:5px;border-radius:5px}.event-badge{padding:8px 20px;border-radius:10px;font-size:24px;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-right:20px;flex-shrink:0;border:2px solid}.event-badge.mint{background-color:transparent;border-color:var(--success-color);color:var(--success-color)}.event-badge.list{background-color:transparent;border-color:var(--info-color);color:var(--info-color)}.artwork-preview{flex:0 0 350px;background-color:var(--bg-light);display:flex;align-items:center;justify-content:center;padding:20px}.artwork-image{width:100%;height:100%;object-fit:contain;border-radius:12px}.artwork-preview video{width:100%;height:100%;object-fit:contain;border-radius:12px}.feed-content{flex:1;padding:40px 50px;display:flex;flex-direction:column;justify-content:space-between}.artwork-info{margin-bottom:30px}.artwork-title-header{display:flex;align-items:center;flex-wrap:wrap;margin-bottom:12px}.artwork-title{font-size:42px;font-weight:600;color:var(--text-primary);line-height:1.3}.collection-name{font-size:30px;color:var(--text-secondary)}.transaction-details{display:flex;flex-direction:column;gap:25px}.detail-row{display:flex;gap:50px;flex-wrap:wrap}.detail-group{display:flex;flex-direction:column;gap:8px;min-width:200px}.detail-label{font-size:24px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;font-weight:500}.detail-value{font-size:32px;color:var(--text-primary);font-weight:500}.detail-value.price{color:var(--text-primary);font-size:38px;font-weight:700}.detail-value.time{color:var(--text-secondary)}.loading,.error,.no-events{text-align:center;padding:60px 20px;color:var(--text-secondary);font-size:28px;width:100%}.loading-logo{width:300px;animation:pulse 2s infinite ease-in-out}.error{color:#ff5252}@keyframes pulse{0%{opacity:1}50%{opacity:.5}100%{opacity:1}}</style>
    <script src="tezticker/cast_receiver_framework.js"></script>
</head>
<body>
    <div class="feed-container" id="eventsContainer">
        <div class="loading">
            <img src="tezticker/logo.svg" alt="Loading..." class="loading-logo">
            <div>Loading...</div>
        </div>
    </div>
    <script>document.addEventListener('DOMContentLoaded',()=>{if(!/CrKey/.test(navigator.userAgent)){startApp();return}const context=cast.framework.CastReceiverContext.getInstance();const namespace='urn:x-cast:com.google.cast.sample.artcast';context.addCustomMessageListener(namespace,customEvent=>{});context.start({statusText:"ArtCast Receiver is ready.",disableIdleTimeout:!0});context.addEventListener(cast.framework.system.EventType.READY,()=>{startApp()})});const API_ENDPOINT='https://data.objkt.com/v3/graphql';const REF_ID='?ref=tz1cUtAZzDf4PmZHgtb2f22xkTRtaLYTufzA';let latestEvent=null;let updateInterval;async function fetchEvents(){const oneDayAgo=new Date(Date.now()-864e5).toISOString();const mintQuery=`query GetMints {
  token(
    order_by: {timestamp: desc},
    limit: 50,
    where: {
      timestamp: {_gte: "${oneDayAgo}"},
      mime: {_in: ["image/png", "image/jpeg", "image/gif", "image/webp", "video/mp4"]}
    }
  ) {
    id: token_id
    type: __typename
    timestamp
    token_id
    fa_contract
    name
    thumbnail_uri
    artifact_uri
    mime
    supply
    creators {
      holder {
        alias
        address
      }
    }
  }
}`;const listQuery=`query GetLists {
  listing(
    order_by: {timestamp: desc},
    limit: 50,
    where: {
      status: {_eq: "active"},
      timestamp: {_gte: "${oneDayAgo}"},
      token: {
        mime: {_in: ["image/png", "image/jpeg", "image/gif", "image/webp", "video/mp4"]}
      }
    }
  ) {
    id
    timestamp
    price
    amount
    token {
      token_id
      fa_contract
      name
      thumbnail_uri
      artifact_uri
      mime
      supply
      creators {
        holder {
          alias
          address
        }
      }
    }
  }
}`;try{const [mintResponse,listResponse]=await Promise.all([fetch(API_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({query:mintQuery})}),fetch(API_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({query:listQuery})})]);const [mintData,listData]=await Promise.all([mintResponse.json(),listResponse.json()]);if(mintData.errors)throw new Error(mintData.errors[0].message);if(listData.errors)throw new Error(listData.errors[0].message);const mints=mintData.data.token.map(t=>({...t,type:'mint',token:t,id:`${t.fa_contract}-${t.token_id}`}));const lists=listData.data.listing.map(l=>({...l,type:'list'}));const allEvents=[...mints,...lists].sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp)).slice(0,50);return allEvents.map(event=>{const amount=event.type==='mint'?event.supply:event.amount;return{id:event.id,type:event.type,timestamp:event.timestamp,token:event.token,price:event.price,amount:amount}})}catch(error){console.error('Error fetching events:',error);throw error}}
function getImageUrl(uri){if(!uri)return null;if(uri.startsWith('ipfs://'))return`https://ipfs.io/ipfs/${uri.replace('ipfs://','')}`;return uri}function formatTimeAgo(timestamp){const diffMins=Math.floor((new Date-new Date(timestamp))/6e4);if(diffMins<1)return"Just now";if(diffMins<60)return`${diffMins}m ago`;const diffHours=Math.floor(diffMins/60);if(diffHours<24)return`${diffHours}h ago`;return`${Math.floor(diffHours/24)}d ago`}function formatPrice(price){if(!price)return null;return`${(price/1e6).toFixed(2)} êœ©`}function getEventType(event){return event.type||"list"}let isFirstLoad=!0;function updateDisplay(event){const container=document.getElementById('eventsContainer');let feedItem=container.querySelector('.feed-item');const mediaUrl=getImageUrl(event.token?.artifact_uri||event.token?.thumbnail_uri);const mimeType=event.token?.mime;const isVideo=mimeType&&mimeType.startsWith('video/');const mediaTagName=isVideo?'VIDEO':'IMG';
function showContent(){if(isFirstLoad){container.innerHTML=`<div class="feed-item" style="opacity:0"><div class="artwork-preview"></div><div class="feed-content"><div class="artwork-info"><div class="artwork-title-header"><div class="event-badge"></div><h3 class="artwork-title"></h3></div><p class="collection-name"></p></div><div class="transaction-details"><div class="detail-row"></div></div></div><div class="qr-code-container"></div></div>`;feedItem=container.querySelector('.feed-item');isFirstLoad=!1}
const updateContent=()=>{const eventType=getEventType(event);const tokenName=event.token?.name||'Untitled';const creatorAlias=event.token?.creators?.[0]?.holder?.alias||event.token?.creators?.[0]?.holder?.address?.substring(0,8)||'Unknown';const price=formatPrice(event.price);const timeAgo=formatTimeAgo(event.timestamp);const amount=event.amount;const tokenUrl=event.token?.fa_contract&&event.token?.token_id?`https://objkt.com/tokens/${event.token.fa_contract}/${event.token.token_id}${REF_ID}`:'#';feedItem.onclick=()=>window.open(tokenUrl,'_blank');const artworkPreview=feedItem.querySelector('.artwork-preview');let mediaEl=artworkPreview.querySelector('img, video');if(!mediaEl||mediaEl.tagName!==mediaTagName){if(mediaEl){if(mediaEl.tagName==='VIDEO'){mediaEl.pause();mediaEl.src=''}
mediaEl.remove()}
mediaEl=document.createElement(mediaTagName.toLowerCase());mediaEl.className='artwork-image';if(isVideo){mediaEl.autoplay=true;mediaEl.muted=true;mediaEl.loop=true;mediaEl.playsInline=true}
artworkPreview.appendChild(mediaEl)}
mediaEl.src=mediaUrl;if(!isVideo)mediaEl.alt=tokenName;const badge=feedItem.querySelector('.event-badge');badge.className=`event-badge ${eventType}`;badge.textContent=eventType;feedItem.querySelector('.artwork-title').textContent=tokenName;feedItem.querySelector('.collection-name').textContent=`by ${creatorAlias}`;feedItem.querySelector('.detail-row').innerHTML=`${price?`<div class="detail-group"><span class="detail-label">Price</span><span class="detail-value price">${price}</span></div>`:''}${amount?`<div class="detail-group"><span class="detail-label">Editions</span><span class="detail-value">${amount}</span></div>`:''}<div class="detail-group"><span class="detail-label">Time</span><span class="detail-value time">${timeAgo}</span></div>${mimeType?`<div class="detail-group"><span class="detail-label">Type</span><span class="detail-value">${mimeType.replace('image/','').replace('video/','')}</span></div>`:''}`;const qrContainer=feedItem.querySelector('.qr-code-container');qrContainer.innerHTML='';if(tokenUrl!=='#')new QRCode(qrContainer,{text:tokenUrl,width:90,height:90,correctLevel:QRCode.CorrectLevel.L});feedItem.style.opacity=1};if(isFirstLoad){updateContent()}else{feedItem.style.opacity=0;setTimeout(updateContent,500)}}
const preloader=document.createElement(isVideo?'video':'img');const readyEvent=isVideo?'loadeddata':'load';const onMediaReady=()=>{if(isVideo)preloader.play().catch(e=>console.error("Autoplay failed",e));showContent();preloader.removeEventListener(readyEvent,onMediaReady);preloader.removeEventListener('error',onMediaError);preloader.src=''}
const onMediaError=()=>{console.error(`Failed to load media: ${mediaUrl}`);preloader.removeEventListener(readyEvent,onMediaReady);preloader.removeEventListener('error',onMediaError);preloader.src=''}
preloader.addEventListener(readyEvent,onMediaReady);preloader.addEventListener('error',onMediaError);preloader.src=mediaUrl}
async function loadEvents(){try{const events=await fetchEvents();if(events&&events.length>0){const newestEvent=events[0];if(!latestEvent||latestEvent.id!==newestEvent.id){latestEvent=newestEvent;updateDisplay(latestEvent)}}else if(isFirstLoad){document.getElementById('eventsContainer').innerHTML='<div class="no-events">No new events found in the last 24 hours.</div>'}}catch(error){document.getElementById('eventsContainer').innerHTML=`<div class="error">Error loading events: ${error.message}</div>`}}
function startApp(){loadEvents();updateInterval=setInterval(loadEvents,30e3);window.addEventListener('beforeunload',()=>{clearInterval(updateInterval)})}
</script>
</body>
</html>

