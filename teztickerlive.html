<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArtCast Receiver</title>
    <script src="tezticker/qrcode.min.js"></script>
    <style>*{margin:0;padding:0;box-sizing:border-box}:root{--primary-color:#FF5722;--bg-dark:#000;--bg-medium:#000;--bg-light:#000;--text-primary:#fff;--text-secondary:#b0b0b0;--text-muted:#707070;--border-color:#333;--success-color:#4caf50;--info-color:#2196f3;--warning-color:#ff9800}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell',sans-serif;background-color:var(--bg-dark);color:var(--text-primary);font-size:28px;line-height:1.6;overflow:hidden}.feed-container{padding:60px;display:flex;flex-direction:column;gap:40px;min-height:100vh}.feed-item{display:flex;align-items:stretch;background-color:var(--bg-medium);border-radius:20px;overflow:hidden;position:relative;min-height:350px;cursor:pointer;transition:opacity .5s ease-in-out}.feed-item:hover{transform:scale(1.01);box-shadow:0 8px 40px rgba(255,87,34,.3)}.qr-code-container{position:absolute;bottom:20px;right:20px;width:100px;height:100px;background:#fff;padding:5px;border-radius:5px}.event-badge{padding:8px 20px;border-radius:10px;font-size:24px;font-weight:600;text-transform:uppercase;letter-spacing:1px;margin-right:20px;flex-shrink:0;border:2px solid}.event-badge.mint{background-color:transparent;border-color:var(--success-color);color:var(--success-color)}.event-badge.auction{background-color:transparent;border-color:var(--warning-color);color:var(--warning-color)}.event-badge.list{background-color:transparent;border-color:var(--info-color);color:var(--info-color)}.artwork-preview{flex:0 0 350px;background-color:var(--bg-light);display:flex;align-items:center;justify-content:center;padding:20px}.artwork-image{width:100%;height:100%;object-fit:contain;border-radius:12px}.feed-content{flex:1;padding:40px 50px;display:flex;flex-direction:column;justify-content:space-between}.artwork-info{margin-bottom:30px}.artwork-title-header{display:flex;align-items:center;flex-wrap:wrap;margin-bottom:12px}.artwork-title{font-size:42px;font-weight:600;color:var(--text-primary);line-height:1.3}.collection-name{font-size:30px;color:var(--text-secondary)}.transaction-details{display:flex;flex-direction:column;gap:25px}.detail-row{display:flex;gap:50px;flex-wrap:wrap}.detail-group{display:flex;flex-direction:column;gap:8px;min-width:200px}.detail-label{font-size:24px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;font-weight:500}.detail-value{font-size:32px;color:var(--text-primary);font-weight:500}.detail-value.price{color:var(--primary-color);font-size:38px;font-weight:700}.detail-value.time{color:var(--text-secondary)}.loading,.error,.no-events{text-align:center;padding:60px 20px;color:var(--text-secondary);font-size:28px;width:100%}.loading-spinner{display:inline-block;width:60px;height:60px;border:6px solid var(--border-color);border-top-color:var(--primary-color);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:20px}.error{color:#ff5252}@keyframes spin{to{transform:rotate(360deg)}}</style>
    <script src="tezticker/cast_receiver_framework.js"></script>
    <script src="tezticker/caf_receiver_logger.js"></script>
</head>
<body>
    <div class="feed-container" id="eventsContainer">
        <div class="loading">
            <div class="loading-spinner"></div>
            <div>Loading OBJKT live activity...</div>
        </div>
    </div>
    <script>document.addEventListener('DOMContentLoaded',()=>{if(!/CrKey/.test(navigator.userAgent)){startApp();return}const context=cast.framework.CastReceiverContext.getInstance();const castDebugLogger=cast.debug.CastDebugLogger.getInstance();const LOG_TAG='ArtCastReceiver';castDebugLogger.setEnabled(!0);castDebugLogger.loggerLevelByTags={[LOG_TAG]:cast.framework.LoggerLevel.DEBUG};const namespace='urn:x-cast:com.google.cast.sample.artcast';context.addCustomMessageListener(namespace,customEvent=>{castDebugLogger.info(LOG_TAG,`Message from sender: ${JSON.stringify(customEvent.data)}`)});context.start({statusText:"ArtCast Receiver is ready."});context.addEventListener(cast.framework.system.EventType.READY,()=>{castDebugLogger.info(LOG_TAG,'Receiver is ready. Starting ArtCast application logic.');startApp()})});const API_ENDPOINT='https://data.objkt.com/v3/graphql';const REF_ID='?ref=tz1cUtAZzDf4PmZHgtb2f22xkTRtaLYTufzA';let latestEvent=null;let updateInterval;async function fetchEvents(){const oneDayAgo=new Date(Date.now()-864e5).toISOString();const query=`query GetLiveEvents{token(order_by:{last_metadata_update:desc},limit:50,where:{last_metadata_update:{_gte:"${oneDayAgo}"},mime:{_in:["image/png","image/jpeg","image/gif","image/webp","video/mp4"]}}){token_id fa_contract name thumbnail_uri artifact_uri mime timestamp last_metadata_update creators{holder{alias address}} listings(limit:1,order_by:{timestamp:desc},where:{status:{_eq:"active"}}){price amount} listings_active(limit:1,order_by:{timestamp:desc}){price amount}}}`;try{const response=await fetch(API_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({query})});const data=await response.json();if(data.errors)throw new Error(data.errors[0].message);const tokens=data.data.token||[];return tokens.map(token=>{const listingPrice=token.listings_active?.[0]?.price||token.listings?.[0]?.price;const amount=token.listings_active?.[0]?.amount;const eventTimestamp=token.listings?.[0]?.timestamp||token.timestamp;const tokenTimestampMs=(new Date(token.timestamp)).getTime();let eventType='list';if(tokenTimestampMs>Date.now()-3e5)eventType='mint';return{id:`${token.fa_contract}-${token.token_id}`,type:eventType,timestamp:eventTimestamp,token:token,price:listingPrice,amount:amount}})}catch(error){console.error('Error fetching events:',error);throw error}}
function getImageUrl(uri){if(!uri)return null;if(uri.startsWith('ipfs://'))return`https://ipfs.io/ipfs/${uri.replace('ipfs://','')}`;return uri}function formatTimeAgo(timestamp){const diffMins=Math.floor((new Date-new Date(timestamp))/6e4);if(diffMins<1)return"Just now";if(diffMins<60)return`${diffMins}m ago`;const diffHours=Math.floor(diffMins/60);if(diffHours<24)return`${diffHours}h ago`;return`${Math.floor(diffHours/24)}d ago`}function formatPrice(price){if(!price)return null;return`${(price/1e6).toFixed(2)} êœ©`}function getEventType(event){return event.type||"list"}let isFirstLoad=!0;function updateDisplay(event){const container=document.getElementById('eventsContainer');let feedItem=container.querySelector('.feed-item');const imageUrl=getImageUrl(event.token?.artifact_uri||event.token?.thumbnail_uri);const preloader=new Image;preloader.onload=()=>{if(isFirstLoad){container.innerHTML=`<div class="feed-item" style="opacity:0"><div class="artwork-preview"><img class="artwork-image" src="" alt=""></div><div class="feed-content"><div class="artwork-info"><div class="artwork-title-header"><div class="event-badge"></div><h3 class="artwork-title"></h3></div><p class="collection-name"></p></div><div class="transaction-details"><div class="detail-row"></div></div></div><div class="qr-code-container"></div></div>`;feedItem=container.querySelector('.feed-item');isFirstLoad=!1}const updateContent=()=>{const eventType=getEventType(event);const tokenName=event.token?.name||'Untitled';const creatorAlias=event.token?.creators?.[0]?.holder?.alias||event.token?.creators?.[0]?.holder?.address?.substring(0,8)||'Unknown';const price=formatPrice(event.price);const timeAgo=formatTimeAgo(event.timestamp);const amount=event.amount;const tokenUrl=event.token?.fa_contract&&event.token?.token_id?`https://objkt.com/tokens/${event.token.fa_contract}/${event.token.token_id}${REF_ID}`:'#';feedItem.onclick=()=>window.open(tokenUrl,'_blank');const imageEl=feedItem.querySelector('.artwork-image');imageEl.src=imageUrl||'https://dummyimage.com/300x300/2c2c2c/ffffff&text=No+Image';imageEl.alt=tokenName;const badge=feedItem.querySelector('.event-badge');badge.className=`event-badge ${eventType}`;badge.textContent=eventType;feedItem.querySelector('.artwork-title').textContent=tokenName;feedItem.querySelector('.collection-name').textContent=`by ${creatorAlias}`;feedItem.querySelector('.detail-row').innerHTML=`${price?`<div class="detail-group"><span class="detail-label">Price</span><span class="detail-value price">${price}</span></div>`:''}${amount?`<div class="detail-group"><span class="detail-label">Editions</span><span class="detail-value">${amount}</span></div>`:''}<div class="detail-group"><span class="detail-label">Time</span><span class="detail-value time">${timeAgo}</span></div>`;const qrContainer=feedItem.querySelector('.qr-code-container');qrContainer.innerHTML='';if(tokenUrl!=='#')new QRCode(qrContainer,{text:tokenUrl,width:90,height:90,correctLevel:QRCode.CorrectLevel.L});feedItem.style.opacity=1};if(isFirstLoad){updateContent()}else{feedItem.style.opacity=0;setTimeout(updateContent,500)}};preloader.onerror=preloader.onload;preloader.src=imageUrl||'https://dummyimage.com/600x600/2c2c2c/ffffff&text=No+Image'}
async function loadEvents(){try{const events=await fetchEvents();if(events&&events.length>0){const newestEvent=events[0];if(!latestEvent||latestEvent.id!==newestEvent.id){latestEvent=newestEvent;updateDisplay(latestEvent)}}else if(isFirstLoad){document.getElementById('eventsContainer').innerHTML='<div class="no-events">No new events found in the last 24 hours.</div>'}}catch(error){document.getElementById('eventsContainer').innerHTML=`<div class="error">Error loading events: ${error.message}</div>`}}
function startApp(){loadEvents();updateInterval=setInterval(loadEvents,30e3);window.addEventListener('beforeunload',()=>{clearInterval(updateInterval)})}
</script>
</body>
</html>

